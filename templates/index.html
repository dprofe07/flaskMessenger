{% extends 'base.html' %}

{% block title %}Главная{% endblock %}

{% block content %}
    {% if user -%}
        <h1>Мессенджер</h1>
        <h2>Вы вошли как {{ user.login }}</h2>
        <p><a href="{{ url_for('logout') }}">Выйти из аккаунта</a></p>
        <p><a href="{{ url_for('remove_account') }}">Удалить аккаунт</a></p>
        <p><a href="{{ url_for('change_password') }}">Сменить пароль</a></p>
        <h3 class="center">Чаты</h3>

        <div class="dialogs-container">
            {% include 'dialogs-div.html' %}
            <div class="dialog">
                <a href="javascript:show_form()" style="font-size: 2em; color: #8b9536" class="center dialog-a" id="plus">+</a>
                <div id="form-new-dialog">
                    <form action="/new-chat" method="post">
                        <span>Вы можете сразу добавить некоторых пользователей, но вы можете добавить их и позже</span><br/>
                        <span>Для совершения некоторых действий (добавление пользователей и пр.) нужен пароль</span><br/><br/>

                        <label for="chat-name">Название чата: </label>
                        <input type="text" name="chat-name" id="chat-name" autocomplete="off" required/><br/>

                        <label for="users">Добавить пользователей (разделяйте ";"): </label>
                        <input type="text" name="users" id="users" autocomplete="off"/><br/>

                        <label for="password">Пароль: </label>
                        <input type="password" name="password" id="password" autocomplete="off" required/><br/>

                        <input type="submit" value="Создать"/>
                    </form>
                </div>
            </div>
        </div>


        <script lang="javascript">
            function show_form() {
                let a_plus = document.getElementById('plus');
                a_plus.style.display = "none";
                let form = document.getElementById('form-new-dialog');
                form.style.display = "block";
            }

            async function reload_div() {
                let div = document.getElementsByClassName('need-update')[0];
                div.outerHTML = await(await fetch('/get-dialogs-div')).text();
            }
            setInterval(reload_div, 10000);
        </script>
    {% else -%}
        <h1>Мессенджер</h1>
        <h2>Вы не авторизировались</h2>
        <p><a href="/auth">Авторизирутесь</a> или <a href="/signup">зарегистрируйтесь</a></p>
    {%- endif -%}


{% endblock %}